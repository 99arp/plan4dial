---
name: extended_ijcai
context_variables:

  request_emergency_help: 
    type: flag 
    init: false
    known:
      type: fflag
      init: false


  request_electric_fire_help: 
    type: flag 
    init: false 
    known: 
      type: flag 
      init: false 


  request_engine_fire_help: 
    type: flag 
    init: false 
    known: 
      type: flag 
      init: false 


  request_wing_fire_help: 
    type: flag 
    init: false 
    known: 
      type: flag 
      init: false 

  got_instruction: 
    type: flag 
    init: false 
  informed: 
    type: flag
    init: false
  
  need_further_help: 
    type: flag 
    init: false

  not_feeling_well: 
    type: flag 
    init: false
  
  sub_dialog_reset: 
    type: flag 
    init: false
  
  second_flag: 
    type: flag 
    init: false 
  

  goal:
    type: flag
    init: false
    known:
      type: flag
      init: false


intents: 
  confirm:
    utterances:
      - "yes" 
      - yeah 
      - yup
      - affirmative
      - aye
  
  deny: 
    utterances:
      - "no"
      - nah 
      - negative 
      - not at all 
      - not really 
  
  share-call_for_help:
    utterances:
      - I have a problem 
      - I need help 
      - Can you help me?  



  share-engine_fire_emergency:
    utterances:
      - I see smokes coming out of my engine
      - My engine is burning
      - I see fire coming from my engine
      - I think my engine has caught fire
      - My engine is on fire


actions: 
  

  get-initial_help_request: 
    type: dialogue
    subtype: resetable
    message_variants:
      - What can I help you with today?

    # fallback_message_variants:
    #   - Can you please repeat that? 

    condition:
      request_emergency_help:
        known: false
        value: false 
    effect: 
      set-emergency_help_type: 
        oneof:
          outcomes: 
            
            update-generic_fire_emergency: 
              updates: 
                request_emergency_help:
                  known: true 
                  value: true
              intent: share-call_for_help

            update-reset: 
              updates: 
                sub_dialog_reset:
                  value: true
              intent: deny
              follow_up: get-not_felling_well
                

              # response_variants:
              #   - I am here to assist you. Please provide me with further information

  get-not_felling_well: 
    type: dialogue
    message_variants:
      - Restart the conversation?

    condition:
      sub_dialog_reset:
        value: true 
    
    effect: 
      set-second_flag: 
        oneof: 
          outcomes:
            update-second_flag: 
              updates: 
                second_flag:
                  value: true 
              intent: confirm



  get-fire_type: 
    type: dialogue
    subtype: resetable
    message_variants:
      - I am here to assist you. Please provide me with further information. 

    # fallback_message_variants:
    #   - Can you please repeat that? 

    condition:
      request_emergency_help:
        known: true
        value: true 
    effect: 
      set-engine_fire_emergency: 
        oneof:
          outcomes: 
            
            update-engine_fire_emergency: 
              updates: 
                request_engine_fire_help:
                  known: true 
                  value: true
              intent: share-engine_fire_emergency
              response_variants:
                - Okay, here are the instructionso. 
    
  get-fire_instruction: 
    type: web_plan
    call: 
      endpoint: "http://127.0.0.1:9000/create_plan" 
      default_payload: {
                      "id":1,
                      "domain_file":"/home/qnc/upf-hierarchical/domain/domainfile.hddl",
                      "problem_file":"/home/qnc/upf-hierarchical/problem/electric_fire.hddl"
      }

    message_variants:
      - Do I even need this?
    condition: 
      request_engine_fire_help:
        known: true 
        value: true

    effect: 
      set-get-fire_instructions: 
        oneof:
          outcomes: 
            update-got_instruction: 
              updates: 
                got_instruction:
                  value: true 
            update-got_instruction_false:
              updates: 
                got_instruction:
                  value: false 


  get-need_further_help: 
    type: dialogue
    message_variants:
      - Do you need any further help?
    condition:
      got_instruction:
        value: true 
    effect:
      set-complete: 
        oneof:
          outcomes:
            update-need_further_help: 
              updates:
                need_further_help:
                  value: true
              intent: confirm



  complete:
    type: system 
    condition: 
      need_further_help:
        value: true
    effect:
      finish:
        oneof:
          outcomes:
            finish:
              updates:
                goal:
                  value: true




